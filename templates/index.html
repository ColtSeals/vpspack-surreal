<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VPS Manager ‚Ä¢ Painel</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg0:#070A12;
      --bg2:#111027;

      --surface: rgba(255,255,255,.06);
      --surface2: rgba(255,255,255,.10);
      --border: rgba(255,255,255,.12);

      --text:#EAF0FF;
      --muted: rgba(234,240,255,.62);

      --p1:#38BDF8;
      --p2:#8B5CF6;
      --p3:#22C55E;

      --danger:#FB7185;
      --warning:#FBBF24;
      --ok:#22C55E;

      --shadow: 0 30px 90px rgba(0,0,0,.55);
      --ring: 0 0 0 4px rgba(56,189,248,.18);

      --r: 18px;
      --r2: 22px;

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    [data-theme="light"]{
      --bg0:#F2F6FF;
      --bg2:#EEF2FF;

      --surface: rgba(0,0,0,.04);
      --surface2: rgba(0,0,0,.06);
      --border: rgba(0,0,0,.10);

      --text:#0B1020;
      --muted: rgba(11,16,32,.60);

      --shadow: 0 22px 70px rgba(0,0,0,.18);
      --ring: 0 0 0 4px rgba(79,70,229,.14);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }

    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(1200px 800px at 15% 10%, rgba(56,189,248,.14), transparent 55%),
        radial-gradient(1100px 800px at 85% 85%, rgba(139,92,246,.14), transparent 55%),
        radial-gradient(900px 600px at 55% 0%, rgba(34,197,94,.07), transparent 60%),
        linear-gradient(135deg, var(--bg0), var(--bg2));
      overflow-x:hidden;
    }

    body::before{
      content:"";
      position:fixed;
      inset:-2px;
      background:
        linear-gradient(to right, rgba(255,255,255,.06) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255,255,255,.06) 1px, transparent 1px);
      background-size: 72px 72px;
      opacity:.16;
      mask-image: radial-gradient(circle at 45% 20%, rgba(0,0,0,.95), transparent 60%);
      pointer-events:none;
    }

    .vm{
      min-height:100vh;
      display:grid;
      grid-template-columns: 280px 1fr;
      gap: 18px;
      padding: 18px;
      position:relative;
      z-index:1;
    }

    /* Sidebar */
    .sidebar{
      border-radius: var(--r2);
      border: 1px solid var(--border);
      background: linear-gradient(180deg, var(--surface2), var(--surface));
      box-shadow: var(--shadow);
      padding: 18px;
      position: sticky;
      top: 18px;
      height: calc(100vh - 36px);
      overflow:hidden;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      padding: 10px 10px 14px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      margin-bottom: 14px;
    }
    .logo{
      width:42px;height:42px;border-radius: 14px;
      background: conic-gradient(from 210deg, var(--p1), var(--p2), var(--p3), var(--p1));
      box-shadow: 0 12px 30px rgba(139,92,246,.22);
    }
    .brand h1{
      margin:0;
      font-size: 16px;
      font-weight: 800;
      letter-spacing: -0.5px;
      line-height:1.1;
    }
    .brand p{
      margin:2px 0 0;
      font-size: 12px;
      color: var(--muted);
    }

    .nav{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top: 12px;
    }
    .nav a, .nav button{
      text-decoration:none;
      color: var(--text);
      background: rgba(0,0,0,.12);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      padding: 12px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      cursor:pointer;
      transition: transform .15s, background .15s, border-color .15s;
      font-family: inherit;
    }
    [data-theme="light"] .nav a, [data-theme="light"] .nav button{
      background: rgba(255,255,255,.50);
    }

    .nav a:hover, .nav button:hover{
      transform: translateY(-1px);
      background: rgba(0,0,0,.16);
      border-color: rgba(255,255,255,.16);
    }

    .nav .left{
      display:flex;
      align-items:center;
      gap:10px;
      color: var(--muted);
      font-size: 13px;
    }
    .chip{
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--muted);
      font-size: 12px;
      white-space:nowrap;
    }

    .danger-link{
      border-color: rgba(251,113,133,.30) !important;
      color: #fecdd3 !important;
      background: rgba(251,113,133,.10) !important;
    }
    .danger-link:hover{ filter: brightness(1.06); }

    /* Main */
    .main{
      border-radius: var(--r2);
      border: 1px solid var(--border);
      background: linear-gradient(180deg, var(--surface2), var(--surface));
      box-shadow: var(--shadow);
      padding: 18px;
      overflow:hidden;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 14px;
      padding: 10px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      margin-bottom: 14px;
    }

    .title{
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .title h2{
      margin:0;
      font-size: 18px;
      font-weight: 800;
      letter-spacing: -0.5px;
      background: linear-gradient(to right, var(--p1), var(--p2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .title span{
      font-size: 12px;
      color: var(--muted);
    }

    .actions{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .btn{
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.14);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-weight: 700;
      font-size: 13px;
      display:inline-flex;
      align-items:center;
      gap:10px;
      transition: transform .15s, filter .15s, border-color .15s;
      font-family: inherit;
      text-decoration:none;
      white-space:nowrap;
    }
    [data-theme="light"] .btn{ background: rgba(255,255,255,.55); }

    .btn:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.18); }
    .btn:active{ transform: translateY(0) scale(.99); }
    .btn:focus-visible{ outline:none; box-shadow: var(--ring); }

    .btn-primary{
      border: none;
      background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 55%, #22c55e 140%);
      box-shadow: 0 18px 45px rgba(139,92,246,.18);
    }
    .btn-primary:hover{ filter: brightness(1.06); }

    .search{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.14);
      min-width: 280px;
    }
    [data-theme="light"] .search{ background: rgba(255,255,255,.55); }

    .search input{
      width: 240px;
      border:0;
      outline:0;
      background: transparent;
      color: var(--text);
      font-family: inherit;
      font-size: 13px;
    }
    .search input::placeholder{ color: rgba(234,240,255,.45); }
    [data-theme="light"] .search input::placeholder{ color: rgba(11,16,32,.45); }

    /* Stats cards */
    .stats{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
      margin: 14px 0 12px;
    }
    .stat{
      border-radius: var(--r);
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.10);
      padding: 14px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    [data-theme="light"] .stat{ background: rgba(255,255,255,.55); }

    .stat .k{
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 4px;
    }
    .stat .v{
      font-size: 20px;
      font-weight: 900;
      letter-spacing:-0.6px;
    }
    .pill{
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      font-size: 12px;
      color: var(--muted);
      white-space:nowrap;
    }

    /* Table */
    .tableWrap{
      margin-top: 12px;
      border-radius: var(--r2);
      border: 1px solid rgba(255,255,255,.12);
      overflow:hidden;
      background: rgba(0,0,0,.10);
    }
    [data-theme="light"] .tableWrap{ background: rgba(255,255,255,.55); }

    table{
      width:100%;
      border-collapse: collapse;
    }
    thead th{
      text-align:left;
      font-size: 11px;
      letter-spacing:.7px;
      text-transform: uppercase;
      color: var(--muted);
      padding: 14px 16px;
      background: rgba(0,0,0,.18);
      border-bottom: 1px solid rgba(255,255,255,.10);
      position: sticky;
      top: 0;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      z-index: 2;
      white-space: nowrap;
    }
    [data-theme="light"] thead th{ background: rgba(255,255,255,.70); }

    tbody td{
      padding: 14px 16px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      vertical-align: middle;
      font-size: 13px;
    }
    tbody tr:hover{ background: rgba(255,255,255,.04); }
    [data-theme="light"] tbody tr:hover{ background: rgba(0,0,0,.03); }

    .userCell{
      display:flex;
      align-items:center;
      gap:12px;
      min-width: 220px;
    }
    .avatar{
      width:34px;height:34px;border-radius: 12px;
      background: conic-gradient(from 180deg, rgba(56,189,248,.9), rgba(139,92,246,.9), rgba(34,197,94,.7), rgba(56,189,248,.9));
      display:grid;
      place-items:center;
      font-weight: 900;
      color: white;
      box-shadow: 0 14px 30px rgba(139,92,246,.18);
      flex:0 0 auto;
    }
    .userMeta{ display:flex; flex-direction:column; gap:2px; }
    .userMeta strong{ font-size: 13px; }
    .userMeta span{ font-size: 12px; color: var(--muted); }

    .mono{ font-family: var(--mono); color: var(--muted); }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      font-size: 12px;
      color: var(--muted);
      white-space:nowrap;
    }
    .dot{
      width:8px;height:8px;border-radius:999px;background: currentColor;
      box-shadow: 0 0 0 4px rgba(255,255,255,.08);
    }
    .on{ color: var(--ok); background: rgba(34,197,94,.10); border-color: rgba(34,197,94,.25); }
    .off{ color: var(--danger); background: rgba(251,113,133,.10); border-color: rgba(251,113,133,.25); }
    .full{ color: var(--warning); background: rgba(251,191,36,.12); border-color: rgba(251,191,36,.30); }

    .actionsCell{
      display:flex;
      gap:8px;
      justify-content:flex-end;
      align-items:center;
      white-space:nowrap;
    }
    .iconBtn{
      width:36px;height:36px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.12);
      color: var(--text);
      cursor:pointer;
      display:grid;
      place-items:center;
      transition: transform .15s, border-color .15s, filter .15s;
      text-decoration:none;
      font-weight: 800;
    }
    [data-theme="light"] .iconBtn{ background: rgba(255,255,255,.55); }
    .iconBtn:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.18); }
    .iconBtn.del:hover{ border-color: rgba(251,113,133,.40); filter: brightness(1.05); }

    /* Modal */
    .overlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,.62);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 999;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }
    .overlay.open{ display:flex; }

    .modal{
      width: 100%;
      max-width: 1000px;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, var(--surface2), var(--surface));
      box-shadow: 0 40px 120px rgba(0,0,0,.65);
      overflow:hidden;
      transform: translateY(14px) scale(.98);
      opacity: 0;
      transition: transform .18s ease, opacity .18s ease;
    }
    .overlay.open .modal{ transform: translateY(0) scale(1); opacity: 1; }

    .modalHead{
      padding: 16px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .modalHead h3{
      margin:0;
      font-size: 15px;
      font-weight: 900;
      letter-spacing:-0.4px;
      background: linear-gradient(to right, var(--p1), var(--p2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .modalClose{
      width:38px;height:38px;border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.12);
      color: var(--text);
      cursor:pointer;
      font-weight: 900;
    }

    .modalBody{
      padding: 16px 18px 18px;
      display:grid;
      gap: 12px;
    }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    .grid3{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px;
    }

    .fg label{
      display:block;
      font-size: 12px;
      color: var(--muted);
      margin: 0 0 6px;
      font-weight: 600;
    }

    .ctrl{
      display:flex;
      gap:10px;
      align-items:center;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.12);
      transition: box-shadow .2s, border-color .2s, transform .2s;
    }
    [data-theme="light"] .ctrl{ background: rgba(255,255,255,.55); }
    .ctrl:focus-within{
      border-color: rgba(56,189,248,.55);
      box-shadow: var(--ring);
      transform: translateY(-1px);
    }
    .ctrl input{
      width:100%;
      border:0;
      outline:0;
      background: transparent;
      color: var(--text);
      font-family: inherit;
      font-size: 13px;
    }

    .miniBtns{
      display:flex;
      gap:8px;
      align-items:center;
    }
    .mini{
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      cursor:pointer;
      padding: 8px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 800;
      transition: transform .15s, filter .15s;
      white-space:nowrap;
    }
    .mini:hover{ transform: translateY(-1px); filter: brightness(1.05); }

    .modalFoot{
      padding: 14px 18px 18px;
      display:flex;
      gap:10px;
      justify-content:flex-end;
      border-top: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.08);
    }
    [data-theme="light"] .modalFoot{ background: rgba(255,255,255,.55); }

    .btnFull{ min-width: 160px; justify-content:center; }

    /* Delete modal variant */
    .modal.dangerBox{ max-width: 420px; border-color: rgba(251,113,133,.30); }
    .modalHead.dangerHead{ background: rgba(251,113,133,.06); }
    .dangerTitle{
      background:none !important;
      -webkit-text-fill-color: var(--danger) !important;
      color: var(--danger) !important;
    }
    .btn-danger{
      border:none;
      background: linear-gradient(135deg, rgba(251,113,133,1) 0%, rgba(139,92,246,1) 140%);
      color:#fff;
      box-shadow: 0 18px 45px rgba(251,113,133,.18);
    }

    /* Toast */
    .toast-box{
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 10000;
      display: flex;
      flex-direction: column;
      gap: 10px;
      pointer-events: none;
    }
    .toast{
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      padding: 12px 14px;
      border-radius: 14px;
      box-shadow: 0 22px 70px rgba(0,0,0,.35);
      color: var(--text);
      font-size: 13px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
      animation: slideIn .25s cubic-bezier(0.16, 1, 0.3, 1);
      pointer-events: auto;
      width: min(380px, calc(100vw - 40px));
    }
    .toast small{ color: var(--muted); font-weight: 500; }
    .toast.success{ border-left: 3px solid var(--ok); }
    .toast.error{ border-left: 3px solid var(--danger); }
    .toast.warn{ border-left: 3px solid var(--warning); }

    @keyframes slideIn{
      from { transform: translateX(16px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    /* Responsive */
    @media (max-width: 980px){
      .vm{ grid-template-columns: 1fr; }
      .sidebar{ position:relative; height:auto; }
      .stats{ grid-template-columns: 1fr; }
      .search{ min-width: unset; }
      .grid2, .grid3{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
<div class="vm" id="app">
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="brand">
      <div class="logo"></div>
      <div>
        <h1>VPS SURREAL</h1>
        <p>Painel ‚Ä¢ Manager</p>
      </div>
    </div>

    <div class="nav">
      <button class="btn" type="button" onclick="toggleTheme()">
        <span class="left">üéõÔ∏è Tema</span>
        <span class="chip" id="theme-chip">Dark</span>
      </button>

      <button class="btn" type="button" onclick="openModal()">
        <span class="left">‚ú® Criar Usu√°rio</span>
        <span class="chip">Novo</span>
      </button>

      <a class="btn" href="#" onclick="monitorNow(); return false;">
        <span class="left">üì° Atualizar Online</span>
        <span class="chip" id="ping">‚Äî</span>
      </a>

      <a class="btn danger-link" href="/login">
        <span class="left">üö™ Sair</span>
        <span class="chip">Logout</span>
      </a>
    </div>

    <div style="margin-top:14px; color: var(--muted); font-size:12px; line-height:1.5">
      <strong style="color: var(--text)">Dica:</strong> CPF √© o login do painel web do cliente (no futuro).
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <div class="topbar">
      <div class="title">
        <h2>Controle de Acessos</h2>
        <span>Monitoramento em tempo real ‚Ä¢ estilo surreal</span>
      </div>

      <div class="actions">
        <div class="search">
          üîé
          <input id="q" placeholder="Buscar por user / nome / cpf / email‚Ä¶" oninput="filterRows()" />
        </div>
        <button class="btn btn-primary" type="button" onclick="openModal()">+ Novo Usu√°rio</button>
      </div>
    </div>

    <!-- STATS -->
    <section class="stats">
      <div class="stat">
        <div>
          <div class="k">Usu√°rios cadastrados</div>
          <div class="v" id="stat-total">‚Äî</div>
        </div>
        <div class="pill">Base</div>
      </div>

      <div class="stat">
        <div>
          <div class="k">Online agora</div>
          <div class="v" id="stat-online">‚Äî</div>
        </div>
        <div class="pill">Live</div>
      </div>

      <div class="stat">
        <div>
          <div class="k">Cheios (no limite)</div>
          <div class="v" id="stat-full">‚Äî</div>
        </div>
        <div class="pill">Alerta</div>
      </div>
    </section>

    <!-- TABLE -->
    <div class="tableWrap">
      <table>
        <thead>
          <tr>
            <th>Cliente</th>
            <th>SSH User</th>
            <th>Senha</th>
            <th>CPF</th>
            <th>Email</th>
            <th>HWID</th>
            <th>Monitor</th>
            <th>Vencimento</th>
            <th style="text-align:right">A√ß√µes</th>
          </tr>
        </thead>

        <tbody id="tbody">
          {% for u in users %}
          <tr class="row-user"
              data-user="{{ (u.username or '') | lower }}"
              data-name="{{ (u.name or '') | lower }}"
              data-cpf="{{ (u.cpf or '') | lower }}"
              data-email="{{ (u.email or '') | lower }}"
              data-hwid="{{ (u.hwid or '') | lower }}">
            <td>
              <div class="userCell">
                <div class="avatar">{{ (u.name or u.username)[:1] | upper }}</div>
                <div class="userMeta">
                  <strong>{{ u.name or 'Sem nome' }}</strong>
                  <span>{{ u.username }}</span>
                </div>
              </div>
            </td>

            <td class="mono">{{ u.username }}</td>

            <td class="mono">
              <span id="pw-{{ u.uuid }}">{{ u.password }}</span>
              <button class="mini" type="button" onclick="copyText('pw-{{ u.uuid }}')">Copiar</button>
            </td>

            <td class="mono">
              <span id="cpf-{{ u.uuid }}">{{ u.cpf or '' }}</span>
              <button class="mini" type="button" onclick="copyText('cpf-{{ u.uuid }}')">Copiar</button>
            </td>

            <td>
              <span id="email-{{ u.uuid }}">{{ u.email or '' }}</span>
              {% if u.email %}
              <button class="mini" type="button" onclick="copyText('email-{{ u.uuid }}')">Copiar</button>
              {% endif %}
            </td>

            <td class="mono">
              <span id="hwid-{{ u.uuid }}">{{ u.hwid or '' }}</span>
              {% if u.hwid %}
              <button class="mini" type="button" onclick="copyText('hwid-{{ u.uuid }}')">Copiar</button>
              {% endif %}
            </td>

            <td>
              <div id="badge-{{ u.username }}" class="badge off">
                <span class="dot"></span>
                <span id="count-{{ u.username }}">0</span>
                <span style="opacity:.7">/ {{ u.limit_conn }}</span>
              </div>
            </td>

            <td>{{ u.expiration_date }}</td>

            <td class="actionsCell">
              <a href="/action/toggle/{{ u.uuid }}" class="iconBtn" title="Bloquear/Liberar">
                {{ 'üîí' if u.is_active else 'üîì' }}
              </a>

              <button class="iconBtn" type="button" title="Derrubar"
                onclick="askKick('{{ u.username }}')">‚ö°</button>

              <button class="iconBtn del" type="button" title="Excluir"
                onclick="askDelete('{{ u.uuid }}', '{{ u.username }}', '{{ u.name or '' }}')">‚úï</button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </main>
</div>

<!-- TOAST -->
<div class="toast-box" id="toast-box"></div>

<!-- MODAL CREATE -->
<div class="overlay" id="modal" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-label="Criar Novo Acesso">
    <div class="modalHead">
      <h3>‚ú® Criar Novo Acesso</h3>
      <button class="modalClose" type="button" onclick="closeModal()" title="Fechar">‚úï</button>
    </div>

    <div class="modalBody">
      <div class="grid2">
        <div class="fg">
          <label>SSH User *</label>
          <div class="ctrl">üë§ <input id="m_user" placeholder="Ex: cliente10" autocomplete="off" /></div>
        </div>

        <div class="fg">
          <label>Senha *</label>
          <div class="ctrl">
            üîë <input id="m_pass" placeholder="Clique em Gerar ou digite" autocomplete="off" />
            <div class="miniBtns">
              <button class="mini" type="button" onclick="genPass()">Gerar</button>
              <button class="mini" type="button" onclick="copyText('m_pass', true)">Copiar</button>
            </div>
          </div>
        </div>
      </div>

      <div class="grid2">
        <div class="fg">
          <label>Nome (cliente)</label>
          <div class="ctrl">üßæ <input id="m_name" placeholder="Nome completo" autocomplete="off" /></div>
        </div>

        <div class="fg">
          <label>CPF *</label>
          <div class="ctrl">ü™™ <input id="m_cpf" placeholder="Somente n√∫meros" inputmode="numeric" autocomplete="off" /></div>
        </div>
      </div>

      <div class="grid2">
        <div class="fg">
          <label>Email</label>
          <div class="ctrl">‚úâÔ∏è <input id="m_email" placeholder="email@dominio.com" autocomplete="off" /></div>
        </div>

        <div class="fg">
          <label>HWID</label>
          <div class="ctrl">üß© <input id="m_hwid" placeholder="ID do dispositivo (opcional)" autocomplete="off" /></div>
        </div>
      </div>

      <div class="grid3">
        <div class="fg">
          <label>Limite</label>
          <div class="ctrl">üß∑ <input id="m_limit" type="number" value="1" min="1" /></div>
        </div>

        <div class="fg">
          <label>Dias</label>
          <div class="ctrl">üìÜ <input id="m_days" type="number" value="30" min="1" /></div>
        </div>

        <div class="fg">
          <label>&nbsp;</label>
          <button class="btn btnFull" type="button" onclick="fillDefaults()">
            ‚ú® Auto preencher
          </button>
        </div>
      </div>

      <div style="color: var(--muted); font-size: 12px; line-height: 1.45;">
        Campos obrigat√≥rios: <b>SSH User</b>, <b>Senha</b> e <b>CPF</b>.
      </div>
    </div>

    <div class="modalFoot">
      <button class="btn btnFull" type="button" onclick="closeModal()">Cancelar</button>
      <button class="btn btn-primary btnFull" id="btnCreate" type="button" onclick="criarUser()">Criar Acesso</button>
    </div>
  </div>
</div>

<!-- MODAL DELETE -->
<div class="overlay" id="modal-delete" aria-hidden="true">
  <div class="modal dangerBox" role="dialog" aria-modal="true" aria-label="Excluir Usu√°rio">
    <div class="modalHead dangerHead">
      <h3 class="dangerTitle">‚ö†Ô∏è Excluir Usu√°rio</h3>
      <button class="modalClose" type="button" onclick="closeDelete()">‚úï</button>
    </div>

    <div class="modalBody" style="text-align:center; padding-top:20px;">
      <p style="font-size:16px; margin:0;">
        Tem certeza que deseja apagar <strong id="del-name" style="color:var(--text)"></strong>?
      </p>
      <p style="font-size:13px; color:var(--muted); margin:10px 0 0;">Esta a√ß√£o n√£o pode ser desfeita.</p>
    </div>

    <div class="modalFoot" style="justify-content:center;">
      <button class="btn" type="button" onclick="closeDelete()">Cancelar</button>
      <button class="btn btn-danger" id="btn-confirm-del" type="button">Sim, Excluir</button>
    </div>
  </div>
</div>

<!-- MODAL KICK -->
<div class="overlay" id="modal-kick" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-label="Derrubar conex√µes" style="max-width:420px;">
    <div class="modalHead">
      <h3>‚ö° Derrubar conex√µes</h3>
      <button class="modalClose" type="button" onclick="closeKick()">‚úï</button>
    </div>

    <div class="modalBody" style="text-align:center;">
      <p style="margin:0; font-size:15px;">Derrubar conex√µes de <strong id="kick-name"></strong> agora?</p>
      <p style="margin:10px 0 0; color:var(--muted); font-size:12px;">Isso desconecta sess√µes SSH ativas.</p>
    </div>

    <div class="modalFoot" style="justify-content:center;">
      <button class="btn" type="button" onclick="closeKick()">Cancelar</button>
      <button class="btn btn-primary" id="btn-confirm-kick" type="button">Derrubar</button>
    </div>
  </div>
</div>

<script>
  // --- TOAST SYSTEM ---
  const Toast = {
    box: document.getElementById('toast-box'),
    show(msg, type='success', detail=''){
      const el = document.createElement('div');
      el.className = 'toast ' + type;
      const icon = type === 'success' ? '‚úÖ' : (type === 'warn' ? '‚ö†Ô∏è' : '‚ùå');
      el.innerHTML = `<span>${icon}</span><div><div>${escapeHtml(msg)}</div>${detail ? `<small>${escapeHtml(detail)}</small>` : ''}</div>`;
      this.box.appendChild(el);
      setTimeout(() => el.remove(), 3500);
    }
  };

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
  }

  // --- THEME ---
  const body = document.body;
  const chip = document.getElementById('theme-chip');

  function toggleTheme(){
    const isLight = body.getAttribute('data-theme') === 'light';
    if(isLight){
      body.removeAttribute('data-theme');
      localStorage.setItem('theme','dark');
      chip.textContent = 'Dark';
    } else {
      body.setAttribute('data-theme','light');
      localStorage.setItem('theme','light');
      chip.textContent = 'Light';
    }
  }
  (function(){
    const saved = localStorage.getItem('theme');
    if(saved === 'light') { body.setAttribute('data-theme','light'); chip.textContent = 'Light'; }
  })();

  // --- MODAL CREATE ---
  const modal = document.getElementById('modal');
  function openModal(){
    modal.classList.add('open');
    modal.setAttribute('aria-hidden','false');
    setTimeout(()=>document.getElementById('m_user').focus(),50);
  }
  function closeModal(){
    modal.classList.remove('open');
    modal.setAttribute('aria-hidden','true');
  }

  // Auto fill helper
  function fillDefaults(){
    if(!document.getElementById('m_pass').value) genPass();
    if(!document.getElementById('m_limit').value) document.getElementById('m_limit').value = 1;
    if(!document.getElementById('m_days').value) document.getElementById('m_days').value = 30;
    Toast.show('Ok', 'success', 'Campos preenchidos.');
  }

  // --- MODAL DELETE ---
  const modalDel = document.getElementById('modal-delete');
  let deleteTargetUUID = null;

  function askDelete(uuid, username, name){
    deleteTargetUUID = uuid;
    const label = (name && name.trim()) ? `${name} (@${username})` : username;
    document.getElementById('del-name').textContent = label;
    modalDel.classList.add('open');
    modalDel.setAttribute('aria-hidden','false');
    document.getElementById('btn-confirm-del').onclick = confirmDelete;
  }

  function closeDelete(){
    modalDel.classList.remove('open');
    modalDel.setAttribute('aria-hidden','true');
    deleteTargetUUID = null;
  }

  function confirmDelete(){
    if(!deleteTargetUUID) return;
    window.location.href = '/action/delete/' + deleteTargetUUID;
  }

  // --- MODAL KICK ---
  const modalKick = document.getElementById('modal-kick');
  let kickTargetUser = null;

  function askKick(username){
    kickTargetUser = username;
    document.getElementById('kick-name').textContent = username;
    modalKick.classList.add('open');
    modalKick.setAttribute('aria-hidden','false');
    document.getElementById('btn-confirm-kick').onclick = confirmKick;
  }

  function closeKick(){
    modalKick.classList.remove('open');
    modalKick.setAttribute('aria-hidden','true');
    kickTargetUser = null;
  }

  function confirmKick(){
    if(!kickTargetUser) return;
    window.location.href = '/action/kick/' + kickTargetUser;
  }

  // --- HELPERS ---
  function genPass(){
    const chars = "ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789!@#$%*_-";
    let out = "";
    for(let i=0;i<12;i++) out += chars[Math.floor(Math.random()*chars.length)];
    document.getElementById('m_pass').value = out;
    Toast.show('Senha gerada', 'success', 'Clique em Copiar se quiser.');
  }

  async function copyText(id, isInput=false){
    const el = document.getElementById(id);
    const txt = isInput ? (el?.value || '') : (el?.textContent || '');
    if(!txt){ Toast.show('Nada para copiar', 'warn'); return; }

    // clipboard API (HTTPS/localhost)
    try{
      if(navigator.clipboard && window.isSecureContext){
        await navigator.clipboard.writeText(txt);
        Toast.show('Copiado!', 'success');
        return;
      }
    } catch(e){}

    // fallback execCommand
    try{
      const ta = document.createElement('textarea');
      ta.value = txt;
      ta.style.position = 'fixed';
      ta.style.left = '-9999px';
      ta.style.top = '-9999px';
      document.body.appendChild(ta);
      ta.focus();
      ta.select();
      const ok = document.execCommand('copy');
      ta.remove();
      if(ok){ Toast.show('Copiado!', 'success'); return; }
    } catch(e){}

    // final fallback (sem popup): mostra instru√ß√£o via toast
    Toast.show('Copiar manual', 'warn', 'Selecione o texto e use Ctrl/Cmd + C.');
  }

  // --- FILTER: user/name/cpf/email/hwid ---
  function filterRows(){
    const q = (document.getElementById('q').value || '').trim().toLowerCase();
    document.querySelectorAll('.row-user').forEach(r=>{
      const hay = [
        r.getAttribute('data-user') || '',
        r.getAttribute('data-name') || '',
        r.getAttribute('data-cpf') || '',
        r.getAttribute('data-email') || '',
        r.getAttribute('data-hwid') || ''
      ].join(' ');
      r.style.display = (!q || hay.includes(q)) ? '' : 'none';
    });
  }

  // --- CREATE USER (refatorado para CPF/NAME/EMAIL/HWID) ---
  async function criarUser(){
    const username = document.getElementById('m_user').value.trim();
    const password = document.getElementById('m_pass').value.trim();
    const name = document.getElementById('m_name').value.trim();
    const cpfRaw = document.getElementById('m_cpf').value.trim();
    const email = document.getElementById('m_email').value.trim();
    const hwid = document.getElementById('m_hwid').value.trim();
    const limit = Number(document.getElementById('m_limit').value);
    const days = Number(document.getElementById('m_days').value);

    const cpf = cpfRaw.replace(/\D/g,'');

    if(!username || !password || !cpf){
      Toast.show('Campos obrigat√≥rios', 'error', 'SSH User, Senha e CPF.');
      return;
    }
    if(cpf.length < 11){
      Toast.show('CPF inv√°lido', 'error', 'Use 11 d√≠gitos.');
      return;
    }
    if(!Number.isFinite(limit) || limit < 1){
      Toast.show('Limite inv√°lido', 'error');
      return;
    }
    if(!Number.isFinite(days) || days < 1){
      Toast.show('Dias inv√°lidos', 'error');
      return;
    }

    const btn = document.getElementById('btnCreate');
    const old = btn.textContent;
    btn.textContent = 'Criando...';
    btn.disabled = true;

    try{
      const res = await fetch('/api/create', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ username, password, cpf, name, email, hwid, limit, days })
      });

      const json = await res.json().catch(()=> ({}));

      if(res.ok && json.status === 'success'){
        Toast.show('Usu√°rio criado', 'success', 'Atualizando...');
        setTimeout(()=>location.reload(), 800);
      } else {
        Toast.show('Erro ao criar', 'error', json.message || ('HTTP ' + res.status));
        btn.textContent = old;
        btn.disabled = false;
      }
    }catch(e){
      Toast.show('Erro de conex√£o', 'error', 'API /api/create indispon√≠vel.');
      btn.textContent = old;
      btn.disabled = false;
    }
  }

  // --- MONITORAMENTO ---
  async function monitorNow(){
    const ping = document.getElementById('ping');
    try{
      const t0 = performance.now();
      const r = await fetch('/api/online');
      const data = await r.json();

      let onlineTotal = 0;
      let fullCount = 0;

      data.forEach(u => {
        const el = document.getElementById('count-'+u.user);
        const badge = document.getElementById('badge-'+u.user);

        if(el) el.textContent = u.online;

        if(badge){
          if(u.online >= u.limit) { badge.className = 'badge full'; fullCount++; }
          else if(u.online > 0) { badge.className = 'badge on'; }
          else badge.className = 'badge off';
        }

        onlineTotal += Number(u.online || 0);
      });

      document.getElementById('stat-online').textContent = onlineTotal;
      document.getElementById('stat-full').textContent = fullCount;

      const ms = Math.round(performance.now() - t0);
      ping.textContent = ms + 'ms';
    } catch(e){
      ping.textContent = 'Offline';
    }
  }

  // Init
  document.getElementById('stat-total').textContent = document.querySelectorAll('.row-user').length;
  setInterval(monitorNow, 2000);
  monitorNow();

  // Close modals on outside click
  window.onclick = function(e){
    if(e.target === modal) closeModal();
    if(e.target === modalDel) closeDelete();
    if(e.target === modalKick) closeKick();
  }

  // ESC closes modals
  document.addEventListener('keydown', (e)=>{
    if(e.key === 'Escape'){
      closeModal(); closeDelete(); closeKick();
    }
  });
</script>
</body>
</html>
